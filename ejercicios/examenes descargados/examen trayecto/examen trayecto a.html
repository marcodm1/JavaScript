 <!DOCTYPE html>
    <html>
    <head>
      <meta content="text/html; charset=UTF-8" http-equiv="content-type">
      <title>Objeto Bicicleta</title>
      <script languaje="javascript">
// OBJETOS
      // Definición del objeto Trayecto
	function Trayecto (txt_des, num_kms, num_cal, date_sal, date_lle) {
		// Definición de propiedades de Trayecto
			this.Descripcion = txt_des;
			this.Kmts        = num_kms;
			this.Calorias    = num_cal;
			this.Salida      = date_sal;
			this.Llegada     = date_lle;
		// Definición de métodos de Trayecto
			this.media       = fnMedia;
            this.duracion    = fnDuracion;
	}
	// Definición del método media
	function fnMedia () {
		with (this) {
			var horas = duracion() / (1000 * 60 * 60);
			return (Kmts / horas);
		}
	}
	// Definición del método duracion
	 function fnDuracion () {
			with (this) {
                             return (Llegada.getTime() - Salida.getTime());
			}
	 }

      // Definición del objeto Bicicleta
	 function Bicicleta (txt_mod, date_adq, array_rut) {
		// Definición de propiedades de Bicicleta
			this.Modelo           = txt_mod;
			this.FechaAdquisicion = date_adq;
			this.Rutas            = array_rut;
		// Definición de métodos de Bicicleta
			this.dia_mas_rapido = fnDiaMasRapido;
			this.tiempo_total   = fnTiempoTotal;
	 }
	// Definición del método dia_mas_fuerte
	 function fnDiaMasRapido () {
			with (this) {
                             var indice = 0;
                             for (var i=1; i < Rutas.length; i++) {
                                 if (Rutas[i].media() > Rutas[indice].media()) {
                                    indice = i;
                                 }
                             }
                             return Rutas[indice].Salida;
			}
	 }
        // Definición del método tiempo_total
	 function fnTiempoTotal () {
			with (this) {
                             var total = 0;
                             for (var i=0; i < Rutas.length; i++) {
                                 total += Rutas[i].duracion();
                             }
                        return total;
			}
	 }
// FUNCIONES
      // Definición de la función pedir_fecha
         function pedir_fecha (texto) {
                        var anio = parseInt(prompt("Introduzca año de " + texto, 2016));
                        var mes  = parseInt(prompt("Introduzca mes de " + texto, 1));
                        while (mes < 1 || mes > 12) {
                             var mes  = parseInt(prompt("Error: Introduzca de nuevo mes de " + texto, 1));
                        }
                        var dia  = parseInt(prompt("Introduzca dia de " + texto, 1));
                        while (dia < 1 || dia > 31) {
                             var dia  = parseInt(prompt("Error: Introduzca de nuevo dia de " + texto, 1));
                        }
                        var fecha = new Date (anio, mes, dia);
                        return fecha;
         }
      // Definición de la función pedir_fecha_hora
         function pedir_fecha_hora (texto) {
                        var fecha = pedir_fecha (texto);
                        var hora = parseInt(prompt("Introduzca hora de " + texto, 0));
                        while (hora < 0 || hora > 23) {
                             var hora  = parseInt(prompt("Error: Introduzca de nuevo hora de " + texto, 0));
                        }
                        var minuto = parseInt(prompt("Introduzca minuto de " + texto, 0));
                        while (minuto < 0 || minuto > 59) {
                             var minuto  = parseInt(prompt("Error: Introduzca de nuevo minuto de " + texto, 0));
                        }
                        fecha.setHours(hora);
                        fecha.setMinutes(minuto);
                        return fecha;
         }
      </script>
    </head>
    <body>
      <script type="text/javascript">
	var mi_Bicicleta = new Bicicleta ();
// Función introducir_datos
	function introducir_datos() {
		var tabla_rutas = new Array();
		mi_Bicicleta.Modelo = prompt("Modelo de Bicicleta");
		mi_Bicicleta.FechaAdquisicion = pedir_fecha("Adquisicion");
		var mas_rutas = true;
		do {
			var descri = prompt("Descripción de la ruta");
			var kilos  = parseInt(prompt("Kms."));
			var calor  = parseInt(prompt("Calorias"));
			var f_sal  = pedir_fecha_hora ("Salida");
			var f_lle  = pedir_fecha_hora ("Llegada");
			while ((f_sal > f_lle) || (f_sal < mi_Bicicleta.FechaAdquisicion)  || (f_lle < mi_Bicicleta.FechaAdquisicion)) {
				alert("Fechas erroneas. Introduzcalas de nuevo");
				var f_sal  = pedir_fecha_hora ("Salida");
				var f_lle  = pedir_fecha_hora ("Llegada");
			}
			tabla_rutas[tabla_rutas.length] = new Trayecto (descri, kilos, calor, f_sal, f_lle);
			mas_rutas = confirm("Más rutas ?");
		} while (mas_rutas);
		mi_Bicicleta.Rutas = tabla_rutas;
        }
// Función mostrar_edad
	function mostrar_edad() {
//		var edad = Math.floor((mi_Bicicleta.dia_mas_rapido().getTime() - mi_Bicicleta.FechaAdquisicion.getTime())
//                                      / (1000*60*60*24*365));
// Mejor para la edad
                var edad = mi_Bicicleta.dia_mas_rapido().getFullYear() - mi_Bicicleta.FechaAdquisicion.getFullYear()
		if (mi_Bicicleta.dia_mas_rapido().getMonth() < mi_Bicicleta.FechaAdquisicion.getMonth()) {
			edad -= 1;
		} else {
			if ((mi_Bicicleta.dia_mas_rapido().getMonth() == mi_Bicicleta.FechaAdquisicion.getMonth())
				&& (mi_Bicicleta.dia_mas_rapido().getDate() < mi_Bicicleta.FechaAdquisicion.getDate())){
				edad -= 1;
			}
		}
//
		alert (edad);
        }
// Función tiempo_total
	function tiempo_total() {
		var horas = Math.floor(mi_Bicicleta.tiempo_total() / (1000*60*60));
		var minu  = Math.floor((mi_Bicicleta.tiempo_total() - horas*60*60*1000) / (1000*60));
                alert("Tiempo total.- " + horas + ":" + minu);
        }
      </script>
       OBJETO Bicicleta<br />
       ==============<br /><br />
       <a href="javascript:introducir_datos()">Introducir datos</a><br />
       <a href="javascript:mostrar_edad()">Mostrar año mas rapido</a><br />
       <a href="javascript:tiempo_total()">Tiempo total rodando</a><br />
    </body>
    </html>
